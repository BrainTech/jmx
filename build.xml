<project name="JMX" default="all" basedir=".">

  <property name="src" location="src" />
  <property name="build" location="bin" />
  <property name="libs" location="${basedir}/libs" />
  <property name="debug" value="true" />

  <path id="project.tools.path">
    <pathelement location="${build}" />
    <pathelement location="${libs}/protobuf.jar" />
    <pathelement location="${libs}/args4j-2.0.10.jar" />
  </path>

  <path id="project.class.path">
    <pathelement location="${build}" />
    <pathelement location="${libs}/protobuf.jar" />
    <pathelement location="${libs}/netty-3.1.0.BETA3.jar" />
    <pathelement location="${libs}/google-collect-1.0-rc2.jar" />
    <pathelement location="${libs}/slf4j-api-1.5.8.jar" />
    <pathelement location="${libs}/slf4j-jdk14-1.5.8.jar" />
    <pathelement location="${libs}/trove-2.0.4.jar" />
    <pathelement location="${libs}/junit-4.6.jar" />
    <pathelement location="${libs}/args4j-2.0.10.jar" />
  </path>

  <!-- all -->
  <target name="all" depends="build,doc" />

  <!-- sources -->
  <target name="sources"
          depends="make-constants"
          description="create the sources that are generated" />

  <!-- build -->
  <target name="build"
          depends="sources"
          description="compiles the sources with debug=${debug}">
    <mkdir dir="${build}" />
    <javac srcdir="${src}"
           destdir="${build}"
           classpathref="project.class.path"
           source="1.5"
           target="1.5"
           encoding="utf8"
           debug="${debug}"
           debuglevel="lines,vars,source">
    </javac>
  </target>

  <!-- make-constants -->
  <target name="make-constants.check">
    <condition property="make-constants.run">
      <not>
        <and>
          <uptodate srcfile="multiplexer.rules"
                    targetfile="${src}/multiplexer/constants/Peers.java" />
          <uptodate srcfile="multiplexer.rules"
                    targetfile="${src}/multiplexer/constants/Types.java" />
        </and>
      </not>
    </condition>
  </target>
  <target name="make-constants"
          depends="make-constants.check"
          if="make-constants.run">
    <javac srcdir="${src}"
           destdir="${build}"
           encoding="utf8"
           classpathref="project.tools.path"
           includes="multiplexer/build/CompileConstants.java"
           verbose="true" />
    <mkdir dir="${src}/multiplexer/constants" />
    <java classname="multiplexer.tools.CompileConstants" failonerror="true">
      <arg value="multiplexer.rules" />
      <arg value="${src}" />
      <arg value="multiplexer/constants/Peers.java" />
      <arg value="multiplexer/constants/Types.java" />
      <classpath refid="project.tools.path" />
    </java>
  </target>

  <!-- javadoc -->
  <target name="doc" depends="make-constants" description="generates Javadoc">
    <javadoc access="protected"
             author="true"
             classpathref="project.class.path"
             destdir="doc"
             sourcepath="${src}"
             encoding="utf8"
             nodeprecated="false"
             nodeprecatedlist="false"
             noindex="false"
             nonavbar="false"
             notree="false"
             source="1.6"
             splitindex="true"
             use="true"
             version="true">
      <link href="http://java.sun.com/javase/6/docs/api/" />
      <link href="http://code.google.com/apis/protocolbuffers/docs/reference/java/" />
      <link href="http://www.jboss.org/file-access/default/members/netty/freezone/api/3.1/" />
      <link href="http://google-collections.googlecode.com/svn/trunk/javadoc/" />
      <package name="*" />
      <excludepackage name="**.test" />
      <excludepackage name="**.test.**" />
    </javadoc>
  </target>

</project>
